
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Médico - Consultorio</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Esto hace que la flechita gire cuando abres el menú */
        details > summary {
            list-style: none;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
        details[open] summary ~ * {
            animation: sweep .3s ease-in-out;
        }
        @keyframes sweep {
            0%    {opacity: 0; transform: translateY(-10px)}
            100%  {opacity: 1; transform: translateY(0)}
        }
    </style>
</head>
<body class="min-h-screen bg-slate-50 p-4 md:p-8">

    <div class="max-w-5xl mx-auto">
        
        <div class="flex flex-col md:flex-row items-center justify-between mb-8 bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
            <div>
                <h2 class="text-3xl font-bold text-slate-800">Gestión Médica</h2>
                <p class="text-slate-500">Bienvenido, {{ user.username|default:"Usuario" }}</p>
            </div>
            <a href="/login/" class="flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-slate-700 transition-colors">
                <i data-lucide="log-out" class="w-4 h-4"></i>
                <span>Salir</span>
            </a>
        </div>

        <div class="space-y-4">

            <details class="group bg-white rounded-xl shadow-sm border border-emerald-100 overflow-hidden">
                <summary class="flex items-center justify-between p-6 cursor-pointer bg-gradient-to-r from-emerald-50 to-white hover:bg-emerald-50 transition-colors">
                    <div class="flex items-center gap-4">
                        <div class="bg-emerald-100 p-3 rounded-full text-emerald-600">
                            <i data-lucide="user-plus" class="w-6 h-6"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-emerald-900">Gestión de Pacientes</h3>
                            <p class="text-sm text-emerald-600">Registrar nuevos pacientes y ver lista</p>
                        </div>
                    </div>
                    <i data-lucide="chevron-down" class="w-5 h-5 text-emerald-400 group-open:rotate-180 transition-transform"></i>
                </summary>

                <div class="p-6 border-t border-emerald-100">
                    <form method="POST" action="{% url 'registrar_paciente' %}" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                        {% csrf_token %}
                        <input type="text" name="paciente-nombre" required placeholder="Nombre Completo" class="p-2 border rounded-md focus:ring-2 focus:ring-emerald-500">
                        <input type="date" name="paciente-fecha-nac" class="p-2 border rounded-md focus:ring-2 focus:ring-emerald-500">
                        <div class="flex gap-2">
                            <input type="tel" name="paciente-telefono" placeholder="Teléfono" class="flex-1 p-2 border rounded-md focus:ring-2 focus:ring-emerald-500">
                            <button type="submit" class="bg-emerald-600 text-white px-4 py-2 rounded-md hover:bg-emerald-700">Guardar</button>
                        </div>
                    </form>

                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-600">
                            <thead class="bg-emerald-50 text-emerald-700">
                                <tr><th class="p-3">ID</th><th class="p-3">Nombre</th><th class="p-3">Teléfono</th></tr>
                            </thead>
                            <tbody class="divide-y">
                                {% for p in pacientes %}
                                <tr><td class="p-3 font-bold">{{ p.id }}</td><td class="p-3">{{ p.nombre }}</td><td class="p-3">{{ p.telefono }}</td></tr>
                                {% empty %}
                                <tr><td colspan="3" class="p-3 text-center">Sin pacientes.</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </details>

            <details class="group bg-white rounded-xl shadow-sm border border-blue-100 overflow-hidden">
                <summary class="flex items-center justify-between p-6 cursor-pointer bg-gradient-to-r from-blue-50 to-white hover:bg-blue-50 transition-colors">
                    <div class="flex items-center gap-4">
                        <div class="bg-blue-100 p-3 rounded-full text-blue-600">
                            <i data-lucide="stethoscope" class="w-6 h-6"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-blue-900">Gestión de Médicos</h3>
                            <p class="text-sm text-blue-600">Registrar especialistas y ver lista</p>
                        </div>
                    </div>
                    <i data-lucide="chevron-down" class="w-5 h-5 text-blue-400 group-open:rotate-180 transition-transform"></i>
                </summary>

                <div class="p-6 border-t border-blue-100">
                    <form method="POST" action="{% url 'registrar_medico' %}" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                        {% csrf_token %}
                        <input type="text" name="medico-nombre" required placeholder="Nombre del Médico" class="p-2 border rounded-md focus:ring-2 focus:ring-blue-500">
                        <input type="text" name="medico-especialidad" placeholder="Especialidad (ej: Cardiología)" class="p-2 border rounded-md focus:ring-2 focus:ring-blue-500">
                        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Guardar Médico</button>
                    </form>

                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-600">
                            <thead class="bg-blue-50 text-blue-700">
                                <tr><th class="p-3">ID</th><th class="p-3">Nombre</th><th class="p-3">Especialidad</th></tr>
                            </thead>
                            <tbody class="divide-y">
                                {% for m in medicos %}
                                <tr><td class="p-3 font-bold">{{ m.id }}</td><td class="p-3">{{ m.nombre }}</td><td class="p-3">{{ m.especialidad }}</td></tr>
                                {% empty %}
                                <tr><td colspan="3" class="p-3 text-center">Sin médicos.</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </details>

            <details open class="group bg-white rounded-xl shadow-sm border border-violet-100 overflow-hidden">
                <summary class="flex items-center justify-between p-6 cursor-pointer bg-gradient-to-r from-violet-50 to-white hover:bg-violet-50 transition-colors">
                    <div class="flex items-center gap-4">
                        <div class="bg-violet-100 p-3 rounded-full text-violet-600">
                            <i data-lucide="calendar-plus" class="w-6 h-6"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-violet-900">Agendar Cita</h3>
                            <p class="text-sm text-violet-600">Crear nueva reserva de hora</p>
                        </div>
                    </div>
                    <i data-lucide="chevron-down" class="w-5 h-5 text-violet-400 group-open:rotate-180 transition-transform"></i>
                </summary>

                <div class="p-6 border-t border-violet-100">
                    <form method="POST" action="{% url 'agendar_cita' %}" class="space-y-4">
                        {% csrf_token %}
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">ID Paciente</label>
                                <input type="number" name="cita-paciente-id" required class="w-full p-2 border rounded-md focus:ring-2 focus:ring-violet-500">
                                <p class="text-xs text-gray-400 mt-1">Mira la tabla verde de arriba.</p>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">ID Médico</label>
                                <input type="number" name="cita-medico-id" required class="w-full p-2 border rounded-md focus:ring-2 focus:ring-violet-500">
                                <p class="text-xs text-gray-400 mt-1">Mira la tabla azul de arriba.</p>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Fecha y Hora</label>
                                <input type="datetime-local" name="cita-fecha" required class="w-full p-2 border rounded-md focus:ring-2 focus:ring-violet-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Motivo</label>
                            <textarea name="cita-motivo" rows="2" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-violet-500" placeholder="Dolor de cabeza, control rutinario..."></textarea>
                        </div>
                        <div class="flex justify-end">
                            <button type="submit" class="bg-violet-600 text-white px-6 py-2 rounded-md hover:bg-violet-700 font-medium">Agendar Cita</button>
                        </div>
                    </form>
                </div>
            </details>

        </div>

        <div class="mt-8 bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="p-6 bg-gray-50 border-b border-gray-200">
                <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                    <i data-lucide="calendar-days" class="w-5 h-5"></i>
                    Próximas Citas Agendadas
                </h3>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm">
                    <thead class="bg-gray-100 text-gray-600 uppercase font-bold">
                        <tr>
                            <th class="p-4">ID</th>
                            <th class="p-4">Fecha</th>
                            <th class="p-4">Paciente</th>
                            <th class="p-4">Médico</th>
                            <th class="p-4">Motivo</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        {% for c in citas %}
                        <tr class="hover:bg-gray-50">
                            <td class="p-4 font-mono text-violet-600">#{{ c.id }}</td>
                            <td class="p-4">{{ c.fecha_hora|date:"d M Y - H:i" }}</td>
                            <td class="p-4 font-medium">{{ c.paciente.nombre }}</td>
                            <td class="p-4 text-gray-600">{{ c.medico.nombre }}</td>
                            <td class="p-4 text-gray-500 italic">{{ c.motivo }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="p-8 text-center text-gray-400">
                                No hay citas programadas. ¡Agenda una arriba!
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        lucide.createIcons();
    </script>

</body>
</html>